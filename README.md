### السر في الظلال

لقد ورثت برنامجًا صغيرًا بلغة C يقوم بقراءة "سر" من ملف، ويسمح للمستخدمين بإدخال بيانات لمحاولة مطابقة هذا السر. إذا تطابق إدخال المستخدم مع السر، يعرض البرنامج رسالة تهنئة. للوهلة الأولى يبدو البرنامج بسيطًا، لكن هناك ثغرة خفية قد تؤدي إلى سلوك غير متوقع أو حتى خطير.

---

#### تحليل الكود واكتشاف الثغرة
َ
بعد مراجعة دقيقة للكود، تبيّن وجود ثغرة أمنية رئيسية تتعلق بإدارة السلاسل النصية والذاكرة. عند مقارنة إدخال المستخدم مع السر باستخدام دالة `strcmp`، لا يتم التأكد من أن كلا السلسلتين منتهيتان بعلامة نهاية السلسلة (`\0`). إذا لم تكن إحدى السلاسل منتهية بشكل صحيح، قد يؤدي ذلك إلى قراءة خارج حدود الذاكرة (out-of-bounds read)، مما قد يتسبب في تسريب معلومات أو انهيار البرنامج.

بالإضافة إلى ذلك، عند قراءة السر من الملف باستخدام `fgets`، قد تبقى محارف نهاية السطر (`\n`) ضمن السلسلة، بينما إدخال المستخدم لا يحتوي عليها، مما يؤدي غالبًا إلى فشل المطابقة حتى لو كانت القيم متطابقة فعليًا.

---

#### العمل المنجز

- مراجعة الكود وتحليل جميع العمليات المتعلقة بالذاكرة والسلاسل النصية.
- تحديد موضع الخلل في المقارنة بين السلاسل النصية.
- تقييم أثر الثغرة على أمان البرنامج واستقراره.

---

#### طرق التحليل

- مراجعة الكود البرمجي يدويًا وتحليل منطق التعامل مع الذاكرة والسلاسل النصية.
- دراسة سلوك دوال لغة C القياسية مثل `fgets` و`strcmp` و`malloc`.
- اختبار سيناريوهات مختلفة مثل وجود أو غياب محارف نهاية السطر، واختلاف أطوال السلاسل النصية.

---

#### التوصيات

- التأكد من إنهاء جميع السلاسل النصية بعلامة `\0` بعد كل عملية إدخال أو قراءة.
- إزالة محارف نهاية السطر (`\n`) من السر المقروء من الملف لضمان مطابقة دقيقة.
- استخدام دوال مقارنة أكثر أمانًا مثل `strncmp` مع تحديد الطول المناسب.
- توحيد طريقة معالجة الإدخال والسر (تطبيع البيانات) قبل المقارنة.

---

#### الخلاصة

الثغرة الأساسية تكمن في سوء التعامل مع السلاسل النصية والذاكرة، مما قد يؤدي إلى سلوك غير متوقع أو ثغرات أمنية خطيرة. معالجة هذه النقاط ترفع من أمان البرنامج وتمنع استغلاله أو تعطله.
